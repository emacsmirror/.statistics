:PREAMBLE:
#+TITLE: Epkgs: Licenses
#+SETUPFILE: .orgconfig
#+NAME: setup
#+BEGIN_SRC emacs-lisp :results silent
  (require 'emir)

  (defun emir--format-license-table (table)
    (--when-let (assoc "failure" table) (setcar it  "((failure))"))
    (--when-let (assoc "pending" table) (setcar it  "((pending))"))
    (--when-let (assoc "none" table)    (setcar it  "((none))"))
    (--when-let (assoc "custom" table)  (setcar it  "((custom))"))
    (let ((total (apply '+ (mapcar 'cadr table)))
          (gnu   (apply '+ (mapcar (pcase-lambda (`(,license ,count))
                                     (if (and license
                                              (string-match-p "GPL" license))
                                         count
                                       0))
                                   table))))
        (cl-flet ((percent (n) (round (* (/ n total 1.0) 100))))
          `(("License" "Count" "Percent")
            hline ,@(mapcar (pcase-lambda (`(,license ,count))
                              (list license count (percent count)))
                            table)
            hline ("total GNU" ,gnu ,(percent gnu))
            hline ("total" ,total 100)))))

  (defun emir--insert-mirror-packages-using-licenses (&rest licenses)
    (epkg-with-org-header ("Package" "License" "Class" "M")
      (mapcar (pcase-lambda (`(,name ,license ,class))
                (list name license class
                      (if (melpa-get name) t "")))
              (epkg-sql [:select [name license class]
                         :from packages
                         :where license :in $v1
                         :and (not (= class 'shelved))
                         :order-by [(asc name)]]
                        (apply #'vector licenses)))))

  (defun emir--insert-attic-packages-using-licenses (&rest licenses)
    (epkg-with-org-header ("Package" "License")
      (epkg-sql [:select [name license] :from packages
                 :where license :in $v1
                 :and (= class 'shelved)
                 :order-by [(asc name)]]
                (apply #'vector licenses))))
#+END_SRC
[[https://emacsmirror.net/stats][up]]
:END:
* Emacsmirror
** Overview
#+NAME: mirror-overview
#+BEGIN_SRC emacs-lisp
  (emir--format-license-table
   (epkg-sql [:select [license (funcall count *)] :as count
              :from packages
              :where (and (not (= class 'builtin))
                          (not (= class 'shelved)))
              :group-by license
              :order-by [(desc count) (asc license)]]))
#+END_SRC
#+RESULTS: mirror-overview
| License       | Count | Percent |
|---------------+-------+---------|
| GPL-3+        |  4024 |      66 |
| GPL-2+        |  1174 |      19 |
| MIT           |   348 |       6 |
| GPL-3         |   182 |       3 |
| BSD-2-clause  |    82 |       1 |
| BSD-3-clause  |    64 |       1 |
| Apache-2.0    |    49 |       1 |
| public-domain |    40 |       1 |
| unlicense     |    37 |       1 |
| WTFPL         |    28 |       0 |
| as-is         |    27 |       0 |
| ISC           |    13 |       0 |
| AGPL-3+       |     8 |       0 |
| LGPL-3+       |     7 |       0 |
| WTFPL-2       |     7 |       0 |
| GPL-2         |     6 |       0 |
| CeCILL        |     4 |       0 |
| GPL-1+        |     3 |       0 |
| ISC (and)     |     3 |       0 |
| Zlib          |     3 |       0 |
| Artistic-2.0  |     2 |       0 |
| COPYLOVE      |     2 |       0 |
| FSFAP         |     2 |       0 |
| ISC (and/or)  |     2 |       0 |
| LGPL-2.1      |     2 |       0 |
| LGPL-3        |     2 |       0 |
| AGPL-3.0      |     1 |       0 |
| BEER-WARE     |     1 |       0 |
| CC-0          |     1 |       0 |
| CC0-1.0       |     1 |       0 |
| GPL           |     1 |       0 |
| LGPL          |     1 |       0 |
| MIT-0         |     1 |       0 |
| MPL-2         |     1 |       0 |
| MS-PL         |     1 |       0 |
| Ruby          |     1 |       0 |
| Unicode TOS   |     1 |       0 |
| ZLIB          |     1 |       0 |
|---------------+-------+---------|
| total GNU     |  5411 |      88 |
|---------------+-------+---------|
| total         |  6133 |     100 |

** Unknown licenses
#+NAME: mirror-unknown
#+BEGIN_SRC emacs-lisp
  (epkg-with-org-header ("Package" "Class" "License")
    (epkg-sql [:select [name class license] :from packages
               :where (isnull license)
               :and (not (= class 'shelved))
               :order-by [(asc name)]]))
#+END_SRC
#+RESULTS: mirror-unknown

* Emacsattic
** Overview
#+NAME: attic-overview
#+BEGIN_SRC emacs-lisp
  (emir--format-license-table
   (epkg-sql [:select [license (funcall count *)] :as count
              :from packages
              :where (= class 'shelved)
              :group-by license
              :order-by count :desc]))
#+END_SRC
#+RESULTS: attic-overview
| License       | Count | Percent |
|---------------+-------+---------|
| GPL-2+        |   814 |      58 |
| GPL-3+        |   334 |      24 |
| GPL-2         |    61 |       4 |
| GPL           |    44 |       3 |
| public-domain |    35 |       3 |
| MIT           |    19 |       1 |
| GPL-3         |    16 |       1 |
| GPL-1+        |    14 |       1 |
| ((custom))    |     9 |       1 |
| as-is         |     8 |       1 |
| BSD-3-clause  |     7 |       1 |
| WTFPL         |     7 |       1 |
| BSD-2-clause  |     4 |       0 |
| Apache-2.0    |     3 |       0 |
| LGPL-3        |     3 |       0 |
| unlicense     |     3 |       0 |
| GPL-2.1+      |     2 |       0 |
| MS-PL         |     2 |       0 |
| AGPL-3+       |     1 |       0 |
| Artistic-1.0  |     1 |       0 |
| BEER-WARE     |     1 |       0 |
| BSD           |     1 |       0 |
| EPL           |     1 |       0 |
| ISC (and)     |     1 |       0 |
| LGPL-2.1      |     1 |       0 |
| LGPL-2.1+     |     1 |       0 |
| WTFPL-2       |     1 |       0 |
|---------------+-------+---------|
| total GNU     |  1291 |      93 |
|---------------+-------+---------|
| total         |  1394 |     100 |

** Unknown licenses
#+NAME: attic-unknown
#+BEGIN_SRC emacs-lisp
  (epkg-with-org-header ("Package" "Class")
    (epkg-sql [:select [name class] :from packages
               :where (isnull license)
               :and packages:class :in $v1
               :order-by [(asc name)]]
              [shelved])))
#+END_SRC
#+RESULTS: attic-unknown

** Custom licenses
#+NAME: attic-custom
#+BEGIN_SRC emacs-lisp
  (emir--insert-attic-packages-using-licenses "custom")
#+END_SRC
#+RESULTS: attic-custom
| Package (9) | License |
|-------------+---------|
| epo         | custom  |
| phutball    | custom  |
| procmaillog | custom  |
| psgml-jade  | custom  |
| rmoo        | custom  |
| speedread   | custom  |
| whine       | custom  |
| yaham       | custom  |
| youwill     | custom  |

** Problematic licenses
#+NAME: attic-problematic
#+BEGIN_SRC emacs-lisp
  (emir--insert-attic-packages-using-licenses "GPL" "GPL-2" "EPL")
#+END_SRC
#+RESULTS: attic-problematic
| Package (106)       | License |
|---------------------+---------|
| align-regexp        | GPL     |
| amigo               | GPL-2   |
| atom-blogger        | GPL     |
| axcess              | GPL     |
| bibtex-mode         | GPL     |
| blip                | GPL-2   |
| breadcrumb          | GPL-2   |
| buffer-thumbnail    | GPL     |
| byrd-biff           | GPL     |
| cdt                 | GPL     |
| clhs                | GPL     |
| commit-patch-buffer | GPL-2   |
| conjecture-mode     | GPL     |
| copyedit            | GPL-2   |
| cruisecontrol       | GPL-2   |
| dbk                 | GPL     |
| devkitemacs         | GPL-2   |
| dired-a             | GPL     |
| dms-sig             | GPL     |
| e-blog              | GPL-2   |
| ec                  | GPL-2   |
| eform               | GPL     |
| elder               | GPL     |
| emdroid             | GPL-2   |
| emuds               | GPL     |
| env-print           | GPL     |
| equinox             | GPL-2   |
| esheet              | GPL-2   |
| espect              | GPL-2   |
| faith               | GPL     |
| filewatch           | GPL     |
| flip-tables         | GPL-2   |
| fluiddb             | GPL-2   |
| foldingo            | GPL     |
| garble              | GPL-2   |
| gb4e                | GPL     |
| global-modes        | GPL     |
| haddoc              | GPL-2   |
| hier-imenu          | GPL-2   |
| html-helper-imenu   | GPL-2   |
| hugs-mode           | GPL     |
| icaps               | GPL-2   |
| ifile-gnus          | GPL     |
| ilisp               | GPL     |
| inkmacs             | GPL     |
| iso-html            | GPL     |
| javadoc-help        | GPL-2   |
| jhg-cload           | GPL-2   |
| lbdb                | GPL-2   |
| line-numbers-mode   | GPL     |
| lines               | GPL     |
| lmselect            | GPL-2   |
| media-files         | GPL-2   |
| mgp-mode-cd         | GPL     |
| miranda-mode        | GPL     |
| mojo                | GPL-2   |
| mutt-alias          | GPL-2   |
| notebook            | GPL-2   |
| osx-itunes          | GPL-2   |
| osx-osascript       | GPL-2   |
| osx-typecreator     | GPL-2   |
| otp                 | GPL-2   |
| outline-m           | GPL     |
| pastie              | GPL     |
| perl-myvar          | GPL-2   |
| physical-line       | GPL     |
| play-mode           | GPL-2   |
| point-ring          | GPL     |
| popup-menu          | GPL     |
| post                | GPL     |
| qa                  | GPL-2   |
| qtdoc               | GPL-2   |
| recent              | GPL-2   |
| redshank            | GPL     |
| rep-words           | GPL-2   |
| repeat-insert       | GPL     |
| repeatable          | GPL-2   |
| reportmail          | GPL     |
| rtf-mode            | GPL-2   |
| save-and-dwim       | GPL-2   |
| sawfish             | GPL-2   |
| scrmable            | GPL-2   |
| slashdot            | GPL-2   |
| slime-ritz          | EPL     |
| spamprobe           | GPL-2   |
| spectre-mode        | GPL     |
| studlycaps          | GPL-2   |
| summarye            | GPL     |
| symlink-fix         | GPL     |
| tab-in-tabular      | GPL-2   |
| texmed              | GPL-2   |
| tie-mode            | GPL     |
| tiger               | GPL-2   |
| tld                 | GPL-2   |
| todochiku           | GPL-2   |
| tumblr              | GPL-2   |
| twit                | GPL-2   |
| undo-group          | GPL-2   |
| wc                  | GPL-2   |
| webinfo             | GPL-2   |
| word-count          | GPL-2   |
| word-counter        | GPL     |
| work-timer          | GPL-2   |
| wsh-repl            | GPL-2   |
| xbase               | GPL-2   |
| zendmd-comint       | GPL-2   |

Notes:
- [[mu4e:msgid:87bmmrmt9x.fsf@ernst][(mail) GPL-2 maintainer feedback]]
