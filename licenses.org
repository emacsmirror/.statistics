:PREAMBLE:
#+TITLE: Epkgs: Licenses
#+SETUPFILE: .orgconfig
#+NAME: setup
#+BEGIN_SRC emacs-lisp :results silent
  (require 'emir)

  (defun emir--format-license-table (table)
    (--when-let (assoc "failure" table) (setcar it  "((failure))"))
    (--when-let (assoc "pending" table) (setcar it  "((pending))"))
    (--when-let (assoc "none" table)    (setcar it  "((none))"))
    (--when-let (assoc "custom" table)  (setcar it  "((custom))"))
    (let ((total (apply '+ (mapcar 'cadr table)))
          (gnu   (apply '+ (mapcar (pcase-lambda (`(,license ,count))
                                     (if (and license
                                              (string-match-p "GPL" license))
                                         count
                                       0))
                                   table))))
        (cl-flet ((percent (n) (round (* (/ n total 1.0) 100))))
          `(("License" "Count" "Percent")
            hline ,@(mapcar (pcase-lambda (`(,license ,count))
                              (list license count (percent count)))
                            table)
            hline ("total GNU" ,gnu ,(percent gnu))
            hline ("total" ,total 100)))))

  (defun emir--insert-mirror-packages-using-licenses (&rest licenses)
    (epkg-with-org-header ("Package" "License" "Class" "M" "Link")
      (mapcar (pcase-lambda (`(,name ,license ,class ,repopage))
                (list name license class
                      (if (melpa-get name) t "")
                      (and (not (eq class 'wiki)) repopage)))
              (epkg-sql [:select [name license class repopage]
                         :from packages
                         :where license :in $v1
                         :and (not (= class 'shelved))
                         :order-by [(asc name)]]
                        (apply #'vector licenses)))))

  (defun emir--insert-attic-packages-using-licenses (&rest licenses)
    (epkg-with-org-header ("Package" "License" "Link")
      (mapcar (pcase-lambda (`(,name ,license ,repopage))
                (list name license
                      (and (not (equal
                                 repopage
                                 "https://github.com/emacsmirror/emacswiki.org"))
                           repopage)))
              (epkg-sql [:select [name license repopage] :from packages
                         :where license :in $v1
                         :and (= class 'shelved)
                         :order-by [(asc name)]]
                        (apply #'vector licenses)))))
#+END_SRC
[[https://emacsmirror.net/stats][up]]
:END:
* Emacsmirror
** Overview
#+NAME: mirror-overview
#+BEGIN_SRC emacs-lisp
  (emir--format-license-table
   (epkg-sql [:select [license (funcall count *)] :as count
              :from packages
              :where (and (not (= class 'builtin))
                          (not (= class 'shelved)))
              :group-by license
              :order-by [(desc count) (asc license)]]))
#+END_SRC
#+RESULTS: mirror-overview
| License       | Count | Percent |
|---------------+-------+---------|
| GPL-3+        |  3587 |      64 |
| GPL-2+        |  1188 |      21 |
| GPL-3         |   169 |       3 |
| MIT           |   167 |       3 |
| MIT (x11)     |   143 |       3 |
| BSD-2-clause  |    76 |       1 |
| BSD-3-clause  |    52 |       1 |
| Apache-2.0    |    42 |       1 |
| public-domain |    37 |       1 |
| unlicense     |    36 |       1 |
| WTFPL         |    31 |       1 |
| as-is         |    31 |       1 |
| WTFPL-2       |     8 |       0 |
| GPL-1+        |     6 |       0 |
| ISC           |     5 |       0 |
| LGPL-3+       |     5 |       0 |
| AGPL-3+       |     4 |       0 |
| ISC (and)     |     3 |       0 |
| LGPL-2.1      |     3 |       0 |
| MS-PL         |     3 |       0 |
| Zlib          |     3 |       0 |
| Artistic-2.0  |     2 |       0 |
| COPYLOVE      |     2 |       0 |
| CeCILL-B      |     2 |       0 |
| LGPL-3        |     2 |       0 |
| nil           |     1 |       0 |
| AGPL-3.0      |     1 |       0 |
| BEER-WARE     |     1 |       0 |
| CC0-1.0       |     1 |       0 |
| GPL-2         |     1 |       0 |
| ISC (and/or)  |     1 |       0 |
| LGPL          |     1 |       0 |
| MPL-2         |     1 |       0 |
| Ruby          |     1 |       0 |
| UIUC          |     1 |       0 |
|---------------+-------+---------|
| total GNU     |  4967 |      88 |
|---------------+-------+---------|
| total         |  5617 |     100 |

** Unknown licenses
#+NAME: mirror-unknown
#+BEGIN_SRC emacs-lisp
  (epkg-with-org-header ("Package" "Class" "License")
    (epkg-sql [:select [name class license] :from packages
               :where (isnull license)
               :and (not (= class 'shelved))
               :order-by [(asc name)]]))
#+END_SRC
#+RESULTS: mirror-unknown
| Package (1) | Class  | License |
|-------------+--------+---------|
| symex       | github |         |

* Emacsattic
** Overview
#+NAME: attic-overview
#+BEGIN_SRC emacs-lisp
  (emir--format-license-table
   (epkg-sql [:select [license (funcall count *)] :as count
              :from packages
              :where (= class 'shelved)
              :group-by license
              :order-by count :desc]))
#+END_SRC
#+RESULTS: attic-overview
| License         | Count | Percent |
|-----------------+-------+---------|
| GPL-2+          |   790 |      64 |
| GPL-3+          |   229 |      18 |
| GPL-2           |    62 |       5 |
| GPL             |    44 |       4 |
| public-domain   |    35 |       3 |
| GPL-1+          |    14 |       1 |
| GPL-3           |     9 |       1 |
| MIT             |     9 |       1 |
| as-is           |     8 |       1 |
| ((custom))      |     6 |       0 |
| BSD-3-clause    |     5 |       0 |
| MIT (x11)       |     5 |       0 |
| nil             |     4 |       0 |
| WTFPL           |     4 |       0 |
| Apache-2.0      |     3 |       0 |
| BSD-2-clause    |     3 |       0 |
| GPL-2.1+        |     2 |       0 |
| LGPL-3          |     2 |       0 |
| AGPL-3+         |     1 |       0 |
| Artistic-1.0    |     1 |       0 |
| BEER-WARE       |     1 |       0 |
| BSD             |     1 |       0 |
| CC BY-NC-SA 3.0 |     1 |       0 |
| EPL             |     1 |       0 |
| ISC (and)       |     1 |       0 |
| LGPL-2.1        |     1 |       0 |
| LGPL-2.1+       |     1 |       0 |
| WTFPL-2         |     1 |       0 |
|-----------------+-------+---------|
| total GNU       |  1155 |      93 |
|-----------------+-------+---------|
| total           |  1244 |     100 |

** Unknown licenses
#+NAME: attic-unknown
#+BEGIN_SRC emacs-lisp
  (epkg-with-org-header ("Package" "Class" "License")
    (epkg-sql [:select [name class license] :from packages
               :where (isnull license)
               :and packages:class :in $v1
               :order-by [(asc name)]]
              [shelved])))
#+END_SRC
#+RESULTS: attic-unknown
| Package (4) | Class   | License |
|-------------+---------+---------|
| epo         | shelved |         |
| rmoo        | shelved |         |
| tj-mode     | shelved |         |
| yaham       | shelved |         |

** Custom licenses
#+NAME: attic-custom
#+BEGIN_SRC emacs-lisp
  (emir--insert-attic-packages-using-licenses "custom")
#+END_SRC
#+RESULTS: attic-custom
| Package (6) | License | Link |
|-------------+---------+------|
| phutball    | custom  |      |
| procmaillog | custom  |      |
| psgml-jade  | custom  |      |
| speedread   | custom  |      |
| whine       | custom  |      |
| youwill     | custom  |      |

** Problematic licenses
#+NAME: attic-problematic
#+BEGIN_SRC emacs-lisp
  (emir--insert-attic-packages-using-licenses "GPL" "GPL-2" "EPL")
#+END_SRC
#+RESULTS: attic-problematic
| Package (107)       | License | Link                                          |
|---------------------+---------+-----------------------------------------------|
| align-regexp        | GPL     |                                               |
| amigo               | GPL-2   |                                               |
| atom-blogger        | GPL     |                                               |
| axcess              | GPL     |                                               |
| bibtex-mode         | GPL     |                                               |
| blip                | GPL-2   |                                               |
| breadcrumb          | GPL-2   | https://github.com/pheaver/breadcrumb         |
| buffer-thumbnail    | GPL     |                                               |
| byrd-biff           | GPL     |                                               |
| cdt                 | GPL     |                                               |
| clhs                | GPL     |                                               |
| commit-patch-buffer | GPL-2   |                                               |
| conjecture-mode     | GPL     |                                               |
| copyedit            | GPL-2   |                                               |
| cruisecontrol       | GPL-2   |                                               |
| dbk                 | GPL     |                                               |
| devkitemacs         | GPL-2   |                                               |
| dired-a             | GPL     |                                               |
| dms-sig             | GPL     |                                               |
| e-blog              | GPL-2   |                                               |
| ec                  | GPL-2   |                                               |
| eform               | GPL     |                                               |
| elder               | GPL     |                                               |
| emdroid             | GPL-2   |                                               |
| emuds               | GPL     |                                               |
| env-print           | GPL     |                                               |
| equinox             | GPL-2   |                                               |
| esheet              | GPL-2   |                                               |
| espect              | GPL-2   | https://github.com/rafl/espect                |
| faith               | GPL     |                                               |
| filewatch           | GPL     |                                               |
| flip-tables         | GPL-2   |                                               |
| fluiddb             | GPL-2   | https://github.com/hdurer/fluiddb.el          |
| foldingo            | GPL     |                                               |
| garble              | GPL-2   | https://github.com/davep/garble.el            |
| gb4e                | GPL     |                                               |
| global-modes        | GPL     |                                               |
| haddoc              | GPL-2   |                                               |
| hier-imenu          | GPL-2   |                                               |
| html-helper-imenu   | GPL-2   |                                               |
| hugs-mode           | GPL     |                                               |
| i-ching             | GPL-2   |                                               |
| icaps               | GPL-2   |                                               |
| ifile-gnus          | GPL     |                                               |
| ilisp               | GPL     |                                               |
| inkmacs             | GPL     |                                               |
| iso-html            | GPL     |                                               |
| javadoc-help        | GPL-2   |                                               |
| jhg-cload           | GPL-2   |                                               |
| lbdb                | GPL-2   | https://github.com/davep/lbdb.el              |
| line-numbers-mode   | GPL     |                                               |
| lines               | GPL     |                                               |
| lmselect            | GPL-2   |                                               |
| media-files         | GPL-2   |                                               |
| mgp-mode-cd         | GPL     |                                               |
| miranda-mode        | GPL     |                                               |
| mojo                | GPL-2   | https://github.com/samsonjs/mojo.el           |
| mutt-alias          | GPL-2   | https://github.com/davep/mutt-alias.el        |
| notebook            | GPL-2   |                                               |
| osx-itunes          | GPL-2   |                                               |
| osx-osascript       | GPL-2   |                                               |
| osx-typecreator     | GPL-2   |                                               |
| otp                 | GPL-2   |                                               |
| outline-m           | GPL     |                                               |
| pastie              | GPL     |                                               |
| perl-myvar          | GPL-2   |                                               |
| physical-line       | GPL     |                                               |
| play-mode           | GPL-2   | https://github.com/emacsorphanage/plywood     |
| point-ring          | GPL     |                                               |
| popup-menu          | GPL     |                                               |
| post                | GPL     |                                               |
| qa                  | GPL-2   |                                               |
| qtdoc               | GPL-2   |                                               |
| recent              | GPL-2   |                                               |
| redshank            | GPL     |                                               |
| rep-words           | GPL-2   |                                               |
| repeat-insert       | GPL     |                                               |
| repeatable          | GPL-2   |                                               |
| reportmail          | GPL     |                                               |
| rtf-mode            | GPL-2   |                                               |
| save-and-dwim       | GPL-2   |                                               |
| sawfish             | GPL-2   |                                               |
| scrmable            | GPL-2   |                                               |
| slashdot            | GPL-2   |                                               |
| slime-ritz          | EPL     |                                               |
| spamprobe           | GPL-2   |                                               |
| spectre-mode        | GPL     |                                               |
| studlycaps          | GPL-2   |                                               |
| summarye            | GPL     |                                               |
| symlink-fix         | GPL     |                                               |
| tab-in-tabular      | GPL-2   |                                               |
| texmed              | GPL-2   |                                               |
| tie-mode            | GPL     |                                               |
| tiger               | GPL-2   |                                               |
| tld                 | GPL-2   | https://github.com/davep/tld.el               |
| todochiku           | GPL-2   |                                               |
| tumblr              | GPL-2   | https://github.com/travisjeffery/emacs-tumblr |
| twit                | GPL-2   | https://github.com/baudtack/twit.el           |
| undo-group          | GPL-2   |                                               |
| wc                  | GPL-2   |                                               |
| webinfo             | GPL-2   | https://github.com/davep/webinfo.el           |
| word-count          | GPL-2   |                                               |
| word-counter        | GPL     |                                               |
| work-timer          | GPL-2   |                                               |
| wsh-repl            | GPL-2   | https://github.com/jonnay/wsh-repl            |
| xbase               | GPL-2   |                                               |
| zendmd-comint       | GPL-2   | https://github.com/jhanson/zendmd-comint.el   |

Notes:
- [[mu4e:msgid:87bmmrmt9x.fsf@ernst][(mail) GPL-2 maintainer feedback]]
